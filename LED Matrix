#define F_CPU 16000000L

#include <avr/io.h>
#include <avr/sfr_defs.h>
#include <avr/interrupt.h>
#include <util/delay.h>

#define DDR_COL DDRD
#define DDR_ROW DDRC
#define PORT_COL PORTD
#define PORT_ROW PORTC

#define COL_ON 1
#define COL_OFF 0
#define ROW_ON 0
#define ROW_OFF 1

int count=0;
uint8_t i=0, j=0;

ISR(TIMER0_OVF_vect)
{
	count++;
	if(count>=64){
		count=0;
		j=(j+1)%10;
	}
}

void write_column_data(uint8_t data)
{
	PORT_COL = data; 
}

void write_row_data(uint8_t data)
{
	PORT_ROW = data;
}

void init_port(void)
{
	DDR_ROW = 0xFF;
	DDR_COL = 0xFF;
	
	PORT_ROW = 0xFF * ROW_OFF;
	PORT_COL = 0xFF * COL_OFF;
}

uint8_t led[10][8] = {
	{0b00111100, 0b01000010, 0b01000010, 0b01000010, 0b01000010, 0b01000010, 0b01000010, 0b00111100},
	{0b00001000, 0b00011000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000},
	{0b00111100, 0b01000010, 0b00000010, 0b00000100, 0b00001000, 0b00010000, 0b00100000, 0b01111110},
    {0b00111100, 0b01000010, 0b00000010, 0b00011100, 0b00000010, 0b00000010, 0b01000010, 0b00111100},
	{0b00001100, 0b00010100, 0b00100100, 0b01000100, 0b01111110, 0b00000100, 0b00000100, 0b00000100},
	{0b01111110, 0b01000000, 0b01000000, 0b01111100, 0b00000010, 0b00000010, 0b00000010, 0b01111100},
	{0b00111100, 0b01000010, 0b01000000, 0b01111100, 0b01000010, 0b01000010, 0b01000010, 0b00111100},
	{0b01111110, 0b00000010, 0b00000010, 0b00000100, 0b00001000, 0b00010000, 0b00100000, 0b01000000},
	{0b00111100, 0b01000010, 0b01000010, 0b00111100, 0b01000010, 0b01000010, 0b01000010, 0b00111100},
	{0b00111100, 0b01000010, 0b01000010, 0b00111100, 0b00000100, 0b00001000, 0b00010000, 0b00100000}};

int main(void)  
{
    /* Replace with your application code */
	init_port();
	
	TCCR0 |= (1 << CS02) | (1 << CS01) | (1 << CS00);
	TIMSK |= (1 << TOIE0);
	sei();
	
    while (1) 
    {
		
		for(i=0 ; i<8 ; i++){
			
	        write_row_data(~(1 << i));
			write_column_data(led[j][i]);
				_delay_ms(2);
			
		}
		
    }
	
}
